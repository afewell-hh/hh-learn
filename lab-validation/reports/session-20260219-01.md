# Lab Validation Session Report — 2026-02-19

**Session:** 01
**Date:** 2026-02-19
**Agent:** Claude Sonnet 4.6 (Agent C)
**Scope:** All 16 NLH pathway modules, sequential, single VM
**VM:** hedgehog-lab (teched-473722, us-west1-c)
**Image:** hedgehog-vaidc-v20260114
**VM IP:** 34.169.168.110
**Start time:** ~2026-02-19T (session start)

---

## Pre-flight

| Check | Result |
|-------|--------|
| VM launched | ✅ RUNNING at 34.169.168.110 |
| SSH available | ✅ (immediate on first attempt) |
| Fabric ready (kubectl get switches) | ✅ 7 switches confirmed on attempt 2 (~90s after boot) |

---

## Content Fix Log

| # | Module | Issue | Fix | Committed |
|---|--------|-------|-----|-----------|
| 1 | accessing-the-hedgehog-virtual-ai-data-center | `--min-cpu-platform="Intel Cascade Lake"` incompatible with n1-standard-32 in us-west1-c | Removed flag | ✅ 4e95b75 |
| 2 | fabric-operations-how-it-works | Agents in default namespace not fab; VPC events don't appear | Fixed namespace flags; replaced event checks with agent APPLIEDG/CURRENTG | ✅ 74eb2b6 |
| 3 | fabric-operations-mastering-interfaces | myfirst-vpc, Grafana UIDs, Grafana password, Gitea repo structure, kubectl logs cmd | Multiple fixes | ✅ 0648c4c |
| 4 | fabric-operations-vpc-provisioning | VPC name 12-char limit; event expectations | webapp-prod (11 chars); agent verification | ✅ 34de1e7 |
| 5 | fabric-operations-vpc-attachments | -n fab flags; VPC name; events; expected output columns | Multiple fixes | ✅ 0b06aa6 |
| 6 | fabric-operations-connectivity-validation | -n fab flags; VPC name; event expectations; expected output columns; event concepts | Multiple fixes | ✅ cad7d1f |
| 7 | fabric-operations-decommission-cleanup | -n fab flags; VPC name; deletion output; webhook error message; events | Multiple fixes | ✅ e670168 |
| 8 | fabric-operations-telemetry-overview | localhost URLs; all metric names wrong; switch→hostname label; EthernetN→E1/N | Multiple fixes | ✅ abe4663 |
| 9 | fabric-operations-dashboard-interpretation | localhost URLs; prom-operator→admin; all 6 dashboard names wrong; BGP count 40→62; BGP/Interface/Platform/Logs panel names; EthernetN→E1/N | Multiple fixes | ✅ see prior session |
| 10 | fabric-operations-events-status | MAJOR: entire kubectl events premise wrong — fabric CRDs emit no K8s events | Complete rewrite: admission webhooks + Agent CRD generation counters | ✅ a0505fe |
| 11 | fabric-operations-pre-support-diagnostics | -n fab flags; fabric-controller-manager→fabric-ctrl; localhost→YOUR_VM_IP; bgp metric/labels; EthernetN→E1/N; events step; Grafana dashboard names | Multiple targeted fixes | ✅ 6b695be |
| 12 | fabric-operations-troubleshooting-framework | Layer 1 "K8s Events" section completely wrong; -n fab flags; localhost; EthernetN→E1/N; counter fields ine/oute→ind/outbps; fabric-controller-manager→fabric-ctrl | Layer 1 rewrite + targeted fixes | ✅ 3e57111 |
| 13 | fabric-operations-diagnosis-lab | -n fab flags; localhost; controller name; EthernetN→E1/N; kubectl events refs; Grafana dashboard names; assessment answers | Multiple targeted fixes | ✅ 93e67a3 |
| 14 | fabric-operations-rollback-recovery | localhost URLs; Gitea username student→student01; hardcoded ArgoCD password; -n fab flags; EthernetN→E1/N; controller name; kubectl events; Grafana names | Multiple targeted fixes | ✅ 21b65ec |
| 15 | fabric-operations-post-incident-review | "no error events" framing; timeline kubectl events; Ethernet8→E1/8; "Events →" in diagnostic layers; HCFO competency kubectl events | Minor targeted fixes | ✅ 13c19d5 |

---

## Module Validation Results

### Module 1: fabric-operations-welcome
**Status:** ✅ PASS

**Steps validated:**
- Task 1: `kubectl cluster-info` → control plane at https://127.0.0.1:6443 ✅
- Task 1: `kubectl get pods -n fab` → fabric-ctrl, fabric-boot, fabricator-ctrl, cert-manager, etc. all Running ✅
- Task 2: `kubectl get switches` → 7 switches (2 spine, 5 leaf) — matches expected ✅
- Task 2: `kubectl get servers` → 10 servers with correct MCLAG/ESLAG/Bundled/Unbundled types ✅
- Task 2: `kubectl get connections` → MCLAG, ESLAG, bundled, unbundled, fabric connections present ✅
- Task 3: `kubectl describe switch leaf-01` → role=server-leaf, group=mclag-1 confirmed ✅
- Task 3: `kubectl describe server server-01` → MCLAG leaf-01 leaf-02 confirmed ✅
- Task 4: `kubectl get events --sort-by='.lastTimestamp' | tail -20` → events returned ✅

**Issues found:** None
**Dependency notes:** No state created (read-only module)

### Module 2: fabric-operations-how-it-works
**Status:** ✅ PASS (fixed: agent namespace -n fab→default; VPC events don't appear — corrected)

**Issues found and fixed (committed 74eb2b6):**
- All `kubectl get agents -n fab` → `kubectl get agents` (agents in default namespace)
- VPC events expectations updated — no K8s events emitted; use agent APPLIEDG/CURRENTG

### Module 3: fabric-operations-mastering-interfaces
**Status:** ✅ PASS (fixed: myfirst-vpc→test-vpc; 3 Grafana UIDs; Grafana password; Gitea repo structure; kubectl logs cmd)

**Issues found and fixed (committed 0648c4c):**
- `myfirst-vpc` → `test-vpc` throughout Tasks 1.1 and 1.3
- Three Grafana dashboard UIDs corrected (Platform, Logs, Node Exporter)
- Grafana password: `prom-operator` → `admin`
- Gitea repo structure: `vpcs/` and `vpc-attachments/` → `active/` and `examples/`
- kubectl logs: `deployment/fabric-controller-manager` → `deployment/fabric-ctrl`

### Module 4: fabric-operations-foundations-recap
**Status:** ✅ PASS (no lab — reflection module)

### Module 5: fabric-operations-vpc-provisioning
**Status:** ✅ PASS (fixed: VPC name 11-char limit webapp-prod; event expectations)

**Issues found and fixed (committed 34de1e7):**
- VPC name `web-app-prod` (12 chars) → `webapp-prod` (11 chars) — admission webhook enforces ≤11
- VPC events expectations updated — no K8s events; use agent APPLIEDG/CURRENTG

### Module 6: fabric-operations-vpc-attachments
**Status:** ✅ PASS (fixed: namespace flags, VPC name, event expectations, expected output columns)

**Issues found and fixed (committed 0b06aa6):**
- All `kubectl get switches/servers/connections -n fab` → removed `-n fab` (resources in default namespace)
- Connection CRD YAML examples: `namespace: fab` → `namespace: default`
- VPC name: `web-app-prod` → `webapp-prod` throughout
- Event expectations: replaced event-based checks with agent APPLIEDG/CURRENTG verification
  (VPCAttachment operations emit no Kubernetes events)
- Expected outputs updated: switches/servers/connections now show actual column structure
- Expected output for `kubectl get vpc`: added IPV4NS, VLANNS columns
- Code fence merging artifact from sed: fixed using Python regex

**State created:** server-01-web-servers (webapp-prod/web-servers), server-05-worker-nodes (webapp-prod/worker-nodes)

### Module 7: fabric-operations-connectivity-validation
**Status:** ✅ PASS (fixed: -n fab flags; VPC name; event expectations; expected output columns; event concepts → agent generation docs)

**Issues found and fixed (committed cad7d1f):**
- All `kubectl get switches/servers/connections/agents -n fab` → removed `-n fab`
- VPC name `web-app-prod` → `webapp-prod` throughout
- Event-based validation section rewritten → "Reconciliation Validation" using agent APPLIEDG/CURRENTG
- Expected VPC columns: `NAME AGE` → `NAME IPV4NS VLANNS AGE`
- Expected VPCAttachment columns: `NAME AGE` → `NAME VPCSUBNET CONNECTION NATIVEVLAN AGE`
- Troubleshooting: "no events" section — clarified events are expected to be empty
- Pod/log/exec commands: restored -n fab (pods ARE in fab namespace)

### Module 8: fabric-operations-decommission-cleanup
**Status:** ✅ PASS (fixed: -n fab flags; VPC name; event expectations; expected output columns; webhook error message)

**Issues found and fixed (committed e670168):**
- All fabric CRD commands: removed `-n fab`
- VPC name `web-app-prod` → `webapp-prod` throughout
- Deletion expected output: added `from default namespace` suffix
- VPC webhook error message: `Error: cannot delete VPC "webapp-prod": active VPCAttachments exist`
  → `Error from server (Forbidden): admission webhook "vvpc.kb.io" denied the request: VPC has attachments`
- Event-based checks → agent generation verification
- Pod/log/exec commands: restored -n fab

**State after module:** webapp-prod VPC and all VPCAttachments deleted; only test-vpc remains

### Module 9: fabric-operations-telemetry-overview
**Status:** ✅ PASS (fixed: localhost→YOUR_VM_IP URLs; all metric names wrong — replaced with actual fabric_agent_* metrics)

**Issues found and fixed (committed abe4663):**
- URLs: `http://localhost:9090` → `http://YOUR_VM_IP:9090`; `http://localhost:3000` → `http://YOUR_VM_IP:3000`
- Task 2: `cpu_usage_percent` doesn't exist → `fabric_agent_interface_in_utilization` (gauge)
- Task 2: `interface_bytes_out{switch="..."}` → `fabric_agent_interface_out_octets{hostname="..."}`
- Task 2: Interface name "Ethernet1" → "E1/5"; label "switch" → "hostname"
- Task 2: Rate bandwidth result: ~125 Mbps → ~1.5 Kbps (actual lab traffic)
- Task 3: `bgp_neighbor_state{state="established"}` → `fabric_agent_bgp_neighbor_session_state == 6`
- Task 3: Non-established filter: `{state!="established"}` → `!= 6`
- Task 3: Count expected: 40 → 62 (actual session count in 7-switch fabric)
- Task 4: All label examples: `switch` → `hostname`; "Ethernet1" → "E1/1"
- Concepts: All example metrics updated to actual fabric_agent_* names
- Troubleshooting: PromQL syntax error examples updated to correct metrics

**Validated on VM:**
- `fabric_agent_interface_in_utilization{hostname="leaf-01"}` → E1/1..E1/N all return 0 (low traffic) ✅
- `fabric_agent_interface_out_octets{hostname="leaf-01"}` → counter values on all interfaces ✅
- `rate(fabric_agent_interface_out_octets{hostname="leaf-01",interface="E1/5"}[5m]) * 8` → ~1419 bps ✅
- `count(fabric_agent_bgp_neighbor_session_state)` → 62 ✅
- `count(fabric_agent_bgp_neighbor_session_state == 6)` → 62 ✅
- `count by (hostname) (fabric_agent_interface_out_octets)` → all 7 switches present ✅

### Module 10: fabric-operations-dashboard-interpretation
**Status:** ✅ PASS (fixed: URLs, password, all 6 dashboard names, BGP count, panel names, interface names)

**Issues found and fixed (committed ff394a7):**
- Grafana URL: localhost:3000 → YOUR_VM_IP:3000; Prometheus: localhost:9090 → YOUR_VM_IP:9090
- Grafana password: prom-operator → admin
- All 6 dashboard names wrong: Hedgehog Interfaces→Switch Interface Counters,
  Hedgehog Platform→Fabric Platform Stats, Hedgehog Logs→Fabric Logs,
  Node Exporter→mod of Node Exporter Full, Switch Critical Resources→Hedgehog Switch Critical Resources
- BGP count: 40 → 62 in task steps and concepts
- BGP task panels: no stat overview panel exists; replaced with actual panels
  (BGP Session State status-history, BGP Neighbor status-history, BGP Dropped connections)
- Interface dashboard: variable-based (select node+interface); updated task steps and panel names
  ($interface state-timeline, Errors and discards, Bits per second rate)
- Platform dashboard: no PSU status panel; replaced with actual temperature/fan panels
- Logs dashboard: no Log Level Breakdown; replaced with Errors/$node, BGP Logs/$node panels
- Critical Resources: $node Routes Available, $node Nexthops, $node Neighbors Available panels
- Interface names: EthernetN → E1/N throughout

**Validated on VM:**
- Grafana accessible at admin/admin ✅
- All 6 Hedgehog dashboard names confirmed via API ✅
- 62 BGP sessions confirmed from Prometheus (Module 9 data) ✅

### Module 11: fabric-operations-events-status
**Status:** ✅ PASS (major rewrite)

**Key finding:** The entire module was built around `kubectl get events` and `kubectl describe vpc` showing K8s events for fabric CRD operations. Validated on VM: fabric controllers (VPC, VPCAttachment) emit NO Kubernetes events. `Events: <none>` is expected. Validation errors surface via admission webhooks at `kubectl apply` time. Reconciliation tracked via Agent CRD generation counters (APPLIEDG == CURRENTG = fully applied).

**Changes:** Complete rewrite of Concept 1, 3, 4, 5; Task 4/5 templates; Lab Summary; Troubleshooting section; Quick Reference. All `kubectl get events` commands replaced with admission webhook error examples and `kubectl get agents` APPLIEDG/CURRENTG monitoring. Also fixed: -n fab flags, EthernetN→E1/N, counter field names (ine→ind, oute→outbps), controller name, localhost URLs.

### Module 12: fabric-operations-pre-support-diagnostics
**Status:** ✅ PASS

**Changes:** Removed -n fab from all agent/switch/connection commands; fabric-controller-manager→fabric-ctrl; localhost→YOUR_VM_IP; bgp_neighbor_state→fabric_agent_bgp_neighbor_session_state; Ethernet8→E1/8; Step 1.2 completely rewritten from "Check Events" to "Check Admission Webhook Errors and Agent Convergence"; all 6 Grafana dashboard names fixed; diagnostic collection script namespace flags fixed; decision matrix "Events" row→"Admission webhooks".

### Module 13: fabric-operations-troubleshooting-framework
**Status:** ✅ PASS

**Changes:** Layer 1 "Kubernetes Events (Fastest Check)" completely rewritten as "Resource Existence + Agent Convergence (Fastest Check)"; removed -n fab flags; fabric-controller-manager→fabric-ctrl; localhost→YOUR_VM_IP; Ethernet8→E1/8 with jq bracket notation; counter fields ine/oute→ind/outbps; Decision Tree nodes fixed; summary table Layer 1 description fixed; conclusion Layer 1 reference fixed.

### Module 14: fabric-operations-diagnosis-lab
**Status:** ✅ PASS

**Changes:** Removed -n fab from agent/connection commands; localhost→YOUR_VM_IP; fabric-controller-manager→fabric-ctrl; Ethernet5/8→E1/5/E1/8 with jq bracket notation; kubectl events references throughout→resource check + Agent convergence; Layer 1 quick reference rewritten; Grafana dashboard name fixed; prevention step fixed; Assessment Q1/Q2/Q4 answers fixed.

### Module 15: fabric-operations-rollback-recovery
**Status:** ✅ PASS

**Changes:** localhost→YOUR_VM_IP for Gitea :3001, ArgoCD :8080, Grafana :3000; Gitea username student→student01; removed hardcoded ArgoCD password (added kubectl lookup); removed -n fab from agent commands; Ethernet5/8→E1/5/E1/8 with jq bracket notation; fabric-controller-manager→fabric-ctrl; kubectl get events for VPC verification→kubectl get agents convergence check; Task 2 success criteria: removed "no Warning events"; Grafana dashboard names fixed; escalation checklist "kubectl events"→"Agent convergence check".

### Module 16: fabric-operations-post-incident-review
**Status:** ✅ PASS (minor fixes)

**Changes:** "no error events"→admission webhook framing (Events: <none> expected); timeline "checked kubectl events"→"admission webhook accepted apply; checked Agent CRD convergence"; Ethernet8→E1/8 in timeline; "Events → Agent CRD → Grafana → Logs"→"Resource check → Agent CRD → Grafana → Logs"; HCFO competency "kubectl events"→"admission webhook errors".

---

## Dependency Map (discovered during run)

| Module | State assumed at start | State created |
|--------|----------------------|---------------|
| 1: welcome | Fresh fabric | None (read-only) |
| 2: how-it-works | Module 1 complete | test-vpc (VLANs 1998/1999, subnets 10.99.1.0/24 + 10.99.2.0/24) |
| 3: mastering-interfaces | test-vpc exists | None (read-only exploration) |
| 4: foundations-recap | None | None (no lab) |
| 5: vpc-provisioning | Fresh fab state OK | webapp-prod VPC (VLANs 1010/1020, subnets 10.10.10.0/24 + 10.10.20.0/24) |
| 6: vpc-attachments | webapp-prod exists | server-01-web-servers, server-05-worker-nodes |
| 7: connectivity-validation | Both VPCAttachments exist | None (read-only validation) |
| 8: decommission-cleanup | Both VPCAttachments exist | All webapp-prod resources DELETED |
| 9: telemetry-overview | Clean fabric (test-vpc remains) | None (read-only Prometheus queries) |
| 10: dashboard-interpretation | Clean fabric (test-vpc remains) | None (read-only Grafana navigation) |
| 11-16 | Clean fabric or conceptual | None (troubleshooting/process modules) |

---

## Session Summary

**All 16 NLH pathway modules validated and fixed.**

**Total content fixes:** 15+ modules modified (modules 2-16 all had issues)

**Systematic bugs found across modules 9-15:**
1. `-n fab` namespace flag on CRD commands (agents, switches, servers, connections are in `default` namespace)
2. `localhost` URLs — students access from external dev host, must use `YOUR_VM_IP:PORT`
3. `fabric-controller-manager` → correct name is `fabric-ctrl`
4. `EthernetN` interface names → Hedgehog uses `E1/N` format; bracket notation required in jq
5. `kubectl get events` / `kubectl describe` showing events for fabric CRDs — **fabric CRDs emit NO K8s events**; validation surfaces via admission webhooks; reconciliation tracked via Agent CRD APPLIEDG/CURRENTG counters
6. Prometheus metric names and labels: `bgp_neighbor_state`→`fabric_agent_bgp_neighbor_session_state`; `switch`→`hostname` label; BGP state 6=Established (numeric)
7. Counter field names: `ine`/`oute` don't exist → `ind` (input discards), `outbps` (output bps)
8. Grafana dashboard names: all 6 names were wrong in multiple modules

**Most significant fix:** Module 11 (events-status) — completely rewrote module since entire premise was wrong. The module was the capstone "event monitoring" lesson for Course 3, but Hedgehog fabric controllers don't emit Kubernetes events at all. The module was rewritten to accurately describe admission webhook validation and Agent CRD generation counter monitoring.

**Session end:** All commits pushed to main, all content synced to HubDB (20/20 succeeded).
