name: CMS Dry-Run Validation
on:
  push: { branches: [ main ] }
  pull_request: { types: [ opened, synchronize, reopened ] }

jobs:
  validate:
    runs-on: ubuntu-latest
    env:
      # Prefer Project App token; fall back to Private App during migration
      HUBSPOT_PROJECT_ACCESS_TOKEN: ${{ secrets.HUBSPOT_PROJECT_ACCESS_TOKEN }}
      HUBSPOT_PRIVATE_APP_TOKEN: ${{ secrets.HUBSPOT_PRIVATE_APP_TOKEN }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: 22 }
      - run: npm ci
      - run: npm run build
      - name: Dry-run provision tables
        run: npm run provision:tables -- --dry-run
      - name: Dry-run provision constants
        run: npm run provision:constants -- --dry-run
      - name: Dry-run provision pages
        run: npm run provision:pages -- --dry-run
