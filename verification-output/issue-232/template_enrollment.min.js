!function(){"use strict";var debug="true"===localStorage.getItem("HHL_DEBUG");function unbindClick(button){button&&button.__hhlHandler&&(button.removeEventListener("click",button.__hhlHandler),button.__hhlHandler=null)}function bindClick(button,handler){button&&(unbindClick(button),button.__hhlHandler=handler,button.addEventListener("click",handler))}function renderSignInState(button,helper,loginUrl,contentType){if(button){unbindClick(button),button.disabled=!1,button.setAttribute("aria-disabled","false"),button.innerHTML="pathway"===contentType?"Sign in to enroll":"Sign in to start course",button.style.background="#1a4e8a",button.style.color="#fff",button.style.border="none",button.style.cursor="pointer";var redirect=function(loginUrl){var base=loginUrl||"/_hcms/mem/login",separator=base.indexOf("?")>=0?"&":"?";return base+separator+"redirect_url="+encodeURIComponent(window.location.pathname+window.location.search)}(loginUrl);bindClick(button,function(event){event.preventDefault(),window.location.href=redirect}),helper&&(helper.style.display="block",helper.innerHTML='Please <a href="'+redirect+'">sign in</a> to '+("pathway"===contentType?"enroll in this pathway.":"start this course."))}}function fetchEnrollmentFromCRM(constants,auth,contentType,slug){return new Promise(function(resolve){var url=function(constants,auth){if(!constants||!constants.TRACK_EVENTS_URL)return null;if(!auth.enableCrm||!auth.email&&!auth.contactId)return null;var base=constants.TRACK_EVENTS_URL;base.indexOf("/events/track")>=0&&(base=base.replace("/events/track",""));var params=[];return auth.email&&params.push("email="+encodeURIComponent(auth.email)),auth.contactId&&params.push("contactId="+encodeURIComponent(auth.contactId)),base+"/enrollments/list"+(params.length?"?"+params.join("&"):"")}(constants,auth);url?fetch(url,{credentials:"omit"}).then(function(res){if(!res.ok)throw new Error("HTTP "+res.status);return res.json()}).then(function(data){if(data&&"authenticated"===data.mode&&data.enrollments){var match=("pathway"===contentType?data.enrollments.pathways||[]:data.enrollments.courses||[]).find(function(entry){return entry&&entry.slug===slug});resolve(match||null)}else resolve(null)}).catch(function(err){debug&&console.warn("[hhl-enroll] Failed to fetch CRM enrollment:",err),resolve(null)}):resolve(null)})}function getEnrollmentState(contentType,slug){var key="hh-enrollment-"+contentType+"-"+slug,stored=localStorage.getItem(key);if(!stored)return null;try{return JSON.parse(stored)}catch(e){return null}}function setEnrollmentState(contentType,slug,enrolled,enrolledAt){var key="hh-enrollment-"+contentType+"-"+slug,state={enrolled:enrolled,enrolled_at:enrolled?enrolledAt||(new Date).toISOString():null};try{localStorage.setItem(key,JSON.stringify(state)),debug&&console.log("[hhl-enroll] Saved state:",key,state)}catch(e){debug&&console.error("[hhl-enroll] Failed to save state:",e)}}function updateButtonUI(button,isEnrolled,contentType){isEnrolled?(button.innerHTML="pathway"===contentType?"✓ Enrolled in Pathway":"✓ Enrolled in Course",button.style.background="#D1FAE5",button.style.color="#065F46",button.style.border="2px solid #6EE7B7",button.disabled=!0,button.style.cursor="not-allowed",button.setAttribute("aria-disabled","true")):(button.innerHTML="pathway"===contentType?"Enroll in Pathway":"Start Course",button.style.background="#1a4e8a",button.style.color="#fff",button.style.border="none",button.disabled=!1,button.style.cursor="pointer",button.setAttribute("aria-disabled","false"))}function handleEnrollClick(button,contentType,slug,auth,constants){button.disabled||(button.disabled=!0,button.innerHTML="Enrolling...",button.setAttribute("aria-disabled","true"),setEnrollmentState(contentType,slug,!0),function(constants,auth,contentType,slug){if(constants&&constants.TRACK_EVENTS_URL){var eventName="pathway"===contentType?"learning_pathway_enrolled":"learning_course_enrolled",payload={ts:(new Date).toISOString()},enrollmentSource="unknown",currentPath=window.location.pathname.toLowerCase();currentPath.includes("/pathways/")?enrollmentSource="pathway_page":currentPath.includes("/courses/")?enrollmentSource="course_page":(currentPath.includes("/learn")||"/"===currentPath)&&(enrollmentSource="catalog");var eventData={eventName:eventName,payload:payload,enrollment_source:enrollmentSource};if("pathway"===contentType?eventData.pathway_slug=slug:eventData.course_slug=slug,auth.enableCrm&&(auth.email||auth.contactId)&&(eventData.contactIdentifier={},auth.email&&(eventData.contactIdentifier.email=auth.email),auth.contactId&&(eventData.contactIdentifier.contactId=auth.contactId)),debug&&console.log("[hhl-enroll] Sending beacon:",eventData),navigator.sendBeacon){var blob=new Blob([JSON.stringify(eventData)],{type:"application/json"});navigator.sendBeacon(constants.TRACK_EVENTS_URL,blob)}else fetch(constants.TRACK_EVENTS_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(eventData),credentials:"omit",keepalive:!0}).catch(function(err){debug&&console.error("[hhl-enroll] Beacon failed:",err)})}else debug&&console.log("[hhl-enroll] No tracking URL configured")}(constants,auth,contentType,slug),setTimeout(function(){updateButtonUI(button,!0,contentType),unbindClick(button),function(message,type){var container=document.getElementById("hhl-toast-container");container||((container=document.createElement("div")).id="hhl-toast-container",container.style.cssText="position: fixed; top: 20px; right: 20px; z-index: 10000;",document.body.appendChild(container));var toast=document.createElement("div");toast.className="hhl-toast hhl-toast-"+type,toast.style.cssText=["background: "+("success"===type?"#D1FAE5":"#FEF3C7"),"border: 1px solid "+("success"===type?"#6EE7B7":"#FCD34D"),"color: "+("success"===type?"#065F46":"#92400E"),"padding: 12px 20px","border-radius: 8px","margin-bottom: 10px","box-shadow: 0 4px 12px rgba(0,0,0,0.15)","min-width: 250px","font-size: 0.875rem","font-weight: 500","display: flex","align-items: center","gap: 8px","animation: slideIn 0.3s ease-out"].join(";");var icon="success"===type?"✓":"ℹ️";toast.innerHTML='<span style="font-size:1.2em">'+icon+"</span><span>"+message+"</span>",container.appendChild(toast),setTimeout(function(){toast.style.opacity="0",toast.style.transition="opacity 0.3s ease-out",setTimeout(function(){container.removeChild(toast)},300)},3e3)}("pathway"===contentType?"Successfully enrolled in pathway!":"Successfully enrolled in course!","success"),debug&&console.log("[hhl-enroll] Enrollment complete:",contentType,slug)},500))}function addToastStyles(){if(!document.getElementById("hhl-toast-styles")){var style=document.createElement("style");style.id="hhl-toast-styles",style.textContent="@keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }",document.head.appendChild(style)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",function(){addToastStyles()}):addToastStyles(),window.hhInitEnrollment=function(contentType,slug){var auth=function(){var authDiv=document.getElementById("hhl-auth-context");if(!authDiv)return debug&&console.warn("[hhl-enroll] Auth context element missing"),{enableCrm:!1,email:"",contactId:"",constantsUrl:"",loginUrl:""};var enableAttr=authDiv.getAttribute("data-enable-crm"),enableCrm=!1;enableAttr&&(enableCrm="true"===enableAttr.toString().toLowerCase());var email=authDiv.getAttribute("data-email")||"",contactId=authDiv.getAttribute("data-contact-id")||"";return debug&&console.log("[hhl-enroll] Auth context:",{hasEmail:!!email,hasContactId:!!contactId,enableCrm:enableCrm}),{email:email,contactId:contactId,enableCrm:enableCrm,constantsUrl:authDiv.getAttribute("data-constants-url")||"",loginUrl:authDiv.getAttribute("data-login-url")||""}}(),button=document.getElementById("hhl-enroll-button");if(button){var helper=document.getElementById("hhl-enroll-helper");!function(auth,callback){if(!auth.constantsUrl)return debug&&console.log("[hhl-enroll] No constants URL"),void callback({});fetch(auth.constantsUrl).then(function(res){return res.json()}).then(function(data){callback(data||{})}).catch(function(err){debug&&console.error("[hhl-enroll] Failed to fetch constants:",err),callback({})})}(auth,function(constants){var loginUrl=function(auth,constants){return auth&&auth.loginUrl?auth.loginUrl:constants&&constants.LOGIN_URL?constants.LOGIN_URL:"/_hcms/mem/login"}(auth,constants);auth.email||auth.contactId?(helper&&(helper.style.display="none",helper.textContent=""),button.disabled=!0,button.setAttribute("aria-disabled","true"),button.innerHTML="Checking enrollment...",fetchEnrollmentFromCRM(constants,auth,contentType,slug).then(function(match){match&&setEnrollmentState(contentType,slug,!0,match.enrolled_at||void 0);var localState=getEnrollmentState(contentType,slug);if(!!match||localState&&localState.enrolled)return updateButtonUI(button,!0,contentType),void unbindClick(button);updateButtonUI(button,!1,contentType),bindClick(button,function(){handleEnrollClick(button,contentType,slug,auth,constants)}),debug&&console.log("[hhl-enroll] Initialized (CRM)",{contentType:contentType,slug:slug})}).catch(function(){debug&&console.warn("[hhl-enroll] Falling back to local enrollment state");var state=getEnrollmentState(contentType,slug),fallbackEnrolled=state&&state.enrolled;updateButtonUI(button,!!fallbackEnrolled,contentType),fallbackEnrolled?unbindClick(button):bindClick(button,function(){handleEnrollClick(button,contentType,slug,auth,constants)})})):renderSignInState(button,helper,loginUrl,contentType)})}else debug&&console.log("[hhl-enroll] No enrollment button found")},debug&&console.log("[hhl-enroll] enrollment.js loaded")}();
//# sourceURL=https://21430285.fs1.hubspotusercontent-na1.net/hubfs/21430285/hub_generated/template_assets/1/197861715501/1760959338769/template_enrollment.js